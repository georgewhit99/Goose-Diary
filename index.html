<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Moments - Daily Diary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,300;0,400;0,600;0,700;1,400&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #fdfbf7;
            --color-surface: #ffffff;
            --color-text: #2d2320;
            --color-text-secondary: #6b5d57;
            --color-primary: #d4845c;
            --color-primary-dark: #b86d47;
            --color-accent: #e8b298;
            --color-border: #e8ddd4;
            --color-shadow: rgba(45, 35, 32, 0.08);

            --mood-anxious: #8b7fa8;
            --mood-happy: #f6c85f;
            --mood-motivated: #6eb5a0;
            --mood-tired: #9eb3c8;
            --mood-grateful: #e89e6f;
            --mood-overwhelmed: #c4918b;
            --mood-peaceful: #a8c5b9;
            --mood-excited: #f19c79;
        }

        .dark {
            --color-bg: #1a1614;
            --color-surface: #2d2320;
            --color-text: #f5ede6;
            --color-text-secondary: #b8a99f;
            --color-primary: #e89e6f;
            --color-primary-dark: #d4845c;
            --color-accent: #6b5d57;
            --color-border: #3d332e;
            --color-shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
            background: var(--color-bg);
        }

        /* Header */
        .app-header {
            background: var(--color-surface);
            padding: 1.5rem 1.5rem 1rem;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(253, 251, 247, 0.95);
        }

        .dark .app-header {
            background: rgba(26, 22, 20, 0.95);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .app-title {
            font-family: 'Fraunces', serif;
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--color-primary);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            font-size: 1.25rem;
        }

        .icon-btn:hover {
            background: var(--color-border);
            color: var(--color-text);
        }

        .icon-btn.active {
            background: var(--color-primary);
            color: white;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            white-space: nowrap;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .nav-tab.active {
            background: var(--color-primary);
            color: white;
        }

        /* Main Content */
        .view-container {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Daily Entry View */
        .daily-view {
            padding: 1.5rem;
        }

        .date-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .current-date {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            color: var(--color-text);
            margin-bottom: 0.25rem;
        }

        .current-day {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        /* Mood Rating */
        .section-card {
            background: var(--color-surface);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px var(--color-shadow);
        }

        .section-title {
            font-family: 'Fraunces', serif;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--color-text);
        }

        .mood-rating {
            display: flex;
            justify-content: space-around;
            gap: 0.5rem;
        }

        .mood-star {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border: 2px solid var(--color-border);
            background: var(--color-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .mood-star:hover {
            transform: scale(1.1);
            border-color: var(--color-primary);
        }

        .mood-star.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            transform: scale(1.15);
        }

        .mood-star.active::after {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px solid var(--color-primary);
            opacity: 0.3;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.1);
                opacity: 0;
            }
        }

        /* Text Input Areas */
        .input-group {
            margin-bottom: 1rem;
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .input-label {
            font-weight: 500;
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .input-actions {
            display: flex;
            gap: 0.5rem;
        }

        .small-icon-btn {
            background: var(--color-border);
            border: none;
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text-secondary);
        }

        .small-icon-btn:hover {
            background: var(--color-primary);
            color: white;
        }

        .small-icon-btn.recording {
            background: #ef4444;
            color: white;
            animation: recordPulse 1.5s ease-in-out infinite;
        }

        @keyframes recordPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            background: var(--color-bg);
            color: var(--color-text);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            transition: all 0.2s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(212, 132, 92, 0.1);
        }

        .photo-upload-area {
            margin-top: 0.75rem;
        }

        .photo-preview {
            display: none;
            margin-top: 0.75rem;
            position: relative;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .photo-preview.has-photo {
            display: block;
        }

        .photo-preview img {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
        }

        .remove-photo {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Mood Tags */
        .mood-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .mood-tag {
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            border: 2px solid var(--color-border);
            background: var(--color-bg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .mood-tag:hover {
            transform: translateY(-2px);
        }

        .mood-tag.active {
            border-color: currentColor;
            transform: translateY(-2px);
        }

        .mood-tag[data-mood="anxious"] { color: var(--mood-anxious); }
        .mood-tag[data-mood="anxious"].active { background: var(--mood-anxious); color: white; }

        .mood-tag[data-mood="happy"] { color: var(--mood-happy); }
        .mood-tag[data-mood="happy"].active { background: var(--mood-happy); color: var(--color-text); }

        .mood-tag[data-mood="motivated"] { color: var(--mood-motivated); }
        .mood-tag[data-mood="motivated"].active { background: var(--mood-motivated); color: white; }

        .mood-tag[data-mood="tired"] { color: var(--mood-tired); }
        .mood-tag[data-mood="tired"].active { background: var(--mood-tired); color: white; }

        .mood-tag[data-mood="grateful"] { color: var(--mood-grateful); }
        .mood-tag[data-mood="grateful"].active { background: var(--mood-grateful); color: white; }

        .mood-tag[data-mood="overwhelmed"] { color: var(--mood-overwhelmed); }
        .mood-tag[data-mood="overwhelmed"].active { background: var(--mood-overwhelmed); color: white; }

        .mood-tag[data-mood="peaceful"] { color: var(--mood-peaceful); }
        .mood-tag[data-mood="peaceful"].active { background: var(--mood-peaceful); color: white; }

        .mood-tag[data-mood="excited"] { color: var(--mood-excited); }
        .mood-tag[data-mood="excited"].active { background: var(--mood-excited); color: white; }

        /* Daily Prompt */
        .daily-prompt {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            color: white;
            padding: 1.5rem;
            border-radius: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .prompt-question {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* Save Button */
        .save-btn {
            width: 100%;
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }

        .save-btn:hover {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 132, 92, 0.3);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        /* Timeline View */
        .timeline-view {
            padding: 1.5rem;
        }

        .flashback-card {
            background: linear-gradient(135deg, var(--mood-peaceful), var(--mood-grateful));
            color: white;
            padding: 1.5rem;
            border-radius: 1.25rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .flashback-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(168, 197, 185, 0.3);
        }

        .flashback-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .flashback-date {
            font-family: 'Fraunces', serif;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .flashback-text {
            font-style: italic;
            line-height: 1.5;
        }

        .moment-card {
            background: var(--color-surface);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--color-shadow);
            border-left: 4px solid var(--color-primary);
            transition: all 0.3s ease;
        }

        .moment-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px var(--color-shadow);
        }

        .moment-date {
            font-family: 'Fraunces', serif;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--color-primary);
        }

        .moment-rating {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .moment-text {
            color: var(--color-text);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .moment-moods {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .moment-mood-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .moment-photo {
            margin-top: 1rem;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .moment-photo img {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: cover;
        }

        /* Weekly Dashboard */
        .dashboard-card {
            background: var(--color-surface);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px var(--color-shadow);
        }

        .dashboard-title {
            font-family: 'Fraunces', serif;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--color-text);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--color-bg);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .stat-label {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .stat-value {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            color: var(--color-primary);
            font-weight: 600;
        }

        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            padding: 1rem;
            background: var(--color-bg);
            border-radius: 0.75rem;
        }

        .word-cloud-item {
            padding: 0.5rem 1rem;
            background: var(--color-primary);
            color: white;
            border-radius: 1.5rem;
            font-weight: 500;
            opacity: 0.9;
            transition: all 0.2s ease;
        }

        .word-cloud-item:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding: 1rem;
            background: var(--color-bg);
            border-radius: 0.75rem;
        }

        .photo-grid-item {
            aspect-ratio: 1;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .photo-grid-item:hover {
            transform: scale(1.05);
        }

        .photo-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Monthly Dashboard */
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--color-surface);
            border-radius: 1rem;
        }

        .month-btn {
            background: var(--color-border);
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--color-text);
        }

        .month-btn:hover {
            background: var(--color-primary);
            color: white;
        }

        .current-month {
            font-family: 'Fraunces', serif;
            font-size: 1.25rem;
            color: var(--color-text);
        }

        .mood-chart {
            padding: 1rem;
            background: var(--color-bg);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            gap: 0.25rem;
        }

        .chart-bar {
            flex: 1;
            background: var(--color-primary);
            border-radius: 0.25rem 0.25rem 0 0;
            min-height: 4px;
            transition: all 0.3s ease;
            position: relative;
        }

        .chart-bar:hover {
            background: var(--color-primary-dark);
        }

        .chart-bar::after {
            content: attr(data-value);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.25rem;
        }

        .chart-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 0.5rem;
        }

        .chart-label {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            text-align: center;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: var(--color-surface);
            border-radius: 1.25rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            color: var(--color-text);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: var(--color-border);
        }

        .success-message {
            background: var(--mood-peaceful);
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            margin-bottom: 1rem;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            border: 2px solid var(--color-border);
            background: var(--color-bg);
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--color-primary);
        }

        .filter-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        input[type="file"] {
            display: none;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .photo-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--color-text-secondary);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% {
                content: '.';
            }
            40% {
                content: '..';
            }
            60%, 100% {
                content: '...';
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-top">
                <h1 class="app-title">My Moments</h1>
                <div class="header-actions">
                    <button class="icon-btn" id="darkModeToggle" title="Toggle dark mode">üåô</button>
                </div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-view="daily">Today</button>
                <button class="nav-tab" data-view="timeline">Timeline</button>
                <button class="nav-tab" data-view="weekly">Week</button>
                <button class="nav-tab" data-view="monthly">Month</button>
            </nav>
        </header>

        <!-- Daily Entry View -->
        <div class="view-container active" id="daily-view">
            <div class="daily-view">
                <div class="date-header">
                    <div class="current-date" id="currentDate"></div>
                    <div class="current-day" id="currentDay"></div>
                </div>

                <div id="successMessage"></div>

                <!-- Daily Prompt (shows occasionally) -->
                <div class="daily-prompt" id="dailyPrompt" style="display: none;">
                    <div class="prompt-question" id="promptQuestion"></div>
                    <div class="input-group">
                        <div class="input-header">
                            <button class="small-icon-btn" id="promptVoiceBtn" title="Voice input">üé§</button>
                        </div>
                        <textarea id="promptAnswer" placeholder="Your thoughts..."></textarea>
                    </div>
                </div>

                <!-- Mood Rating -->
                <div class="section-card">
                    <h2 class="section-title">How was your day?</h2>
                    <div class="mood-rating" id="moodRating">
                        <button class="mood-star" data-rating="1">‚≠ê</button>
                        <button class="mood-star" data-rating="2">‚≠ê</button>
                        <button class="mood-star" data-rating="3">‚≠ê</button>
                        <button class="mood-star" data-rating="4">‚≠ê</button>
                        <button class="mood-star" data-rating="5">‚≠ê</button>
                    </div>
                </div>

                <!-- Moment with Kids -->
                <div class="section-card">
                    <h2 class="section-title">Moment with the Kids</h2>
                    <div class="input-group">
                        <div class="input-header">
                            <span class="input-label">Share a special moment</span>
                            <div class="input-actions">
                                <button class="small-icon-btn" id="kidsVoiceBtn" title="Voice input">üé§</button>
                                <label class="small-icon-btn" for="kidsPhoto" title="Add photo">üì∑</label>
                                <input type="file" id="kidsPhoto" accept="image/*">
                            </div>
                        </div>
                        <textarea id="kidsText" placeholder="What made this moment special?"></textarea>
                        <div class="photo-preview" id="kidsPhotoPreview">
                            <img id="kidsPhotoImg" alt="Kids moment">
                            <button class="remove-photo" id="removeKidsPhoto">‚úï</button>
                        </div>
                    </div>
                </div>

                <!-- Moment for Yourself -->
                <div class="section-card">
                    <h2 class="section-title">Moment for Yourself</h2>
                    <div class="input-group">
                        <div class="input-header">
                            <span class="input-label">A moment just for you</span>
                            <div class="input-actions">
                                <button class="small-icon-btn" id="selfVoiceBtn" title="Voice input">üé§</button>
                                <label class="small-icon-btn" for="selfPhoto" title="Add photo">üì∑</label>
                                <input type="file" id="selfPhoto" accept="image/*">
                            </div>
                        </div>
                        <textarea id="selfText" placeholder="How did you take care of yourself today?"></textarea>
                        <div class="photo-preview" id="selfPhotoPreview">
                            <img id="selfPhotoImg" alt="Self care moment">
                            <button class="remove-photo" id="removeSelfPhoto">‚úï</button>
                        </div>
                    </div>
                </div>

                <!-- Mood Tags -->
                <div class="section-card">
                    <h2 class="section-title">Today I felt...</h2>
                    <div class="mood-tags" id="moodTags">
                        <button class="mood-tag" data-mood="happy">üòä Happy</button>
                        <button class="mood-tag" data-mood="grateful">üôè Grateful</button>
                        <button class="mood-tag" data-mood="motivated">üí™ Motivated</button>
                        <button class="mood-tag" data-mood="peaceful">üòå Peaceful</button>
                        <button class="mood-tag" data-mood="excited">üéâ Excited</button>
                        <button class="mood-tag" data-mood="tired">üò¥ Tired</button>
                        <button class="mood-tag" data-mood="anxious">üò∞ Anxious</button>
                        <button class="mood-tag" data-mood="overwhelmed">üòì Overwhelmed</button>
                    </div>
                </div>

                <button class="save-btn" id="saveEntry">Save Today's Entry</button>
            </div>
        </div>

        <!-- Timeline View -->
        <div class="view-container" id="timeline-view">
            <div class="timeline-view">
                <div id="flashbackContainer"></div>

                <div class="filter-buttons" id="timelineFilters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="week">This Week</button>
                    <button class="filter-btn" data-filter="month">This Month</button>
                </div>

                <div id="timelineEntries"></div>
            </div>
        </div>

        <!-- Weekly Dashboard -->
        <div class="view-container" id="weekly-view">
            <div class="daily-view">
                <div class="dashboard-card">
                    <h2 class="dashboard-title">This Week's Summary</h2>
                    <div class="stat-row">
                        <span class="stat-label">Average Mood</span>
                        <span class="stat-value" id="weeklyAvgMood">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Entries This Week</span>
                        <span class="stat-value" id="weeklyEntryCount">0</span>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h2 class="dashboard-title">Most Used Words</h2>
                    <div class="word-cloud" id="weeklyWordCloud"></div>
                </div>

                <div class="dashboard-card">
                    <h2 class="dashboard-title">This Week's Photos</h2>
                    <div class="photo-grid" id="weeklyPhotos"></div>
                </div>
            </div>
        </div>

        <!-- Monthly Dashboard -->
        <div class="view-container" id="monthly-view">
            <div class="daily-view">
                <div class="month-selector">
                    <button class="month-btn" id="prevMonth">‚Üê</button>
                    <div class="current-month" id="currentMonth"></div>
                    <button class="month-btn" id="nextMonth">‚Üí</button>
                </div>

                <div class="dashboard-card">
                    <h2 class="dashboard-title">Monthly Mood Trend</h2>
                    <div class="mood-chart">
                        <div class="chart-bars" id="monthlyMoodChart"></div>
                        <div class="chart-labels" id="monthlyMoodLabels"></div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h2 class="dashboard-title">Monthly Statistics</h2>
                    <div class="stat-row">
                        <span class="stat-label">Average Mood</span>
                        <span class="stat-value" id="monthlyAvgMood">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Entries</span>
                        <span class="stat-value" id="monthlyEntryCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Best Day</span>
                        <span class="stat-value" id="monthlyBestDay">-</span>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h2 class="dashboard-title">Monthly Photos</h2>
                    <div class="photo-grid" id="monthlyPhotos"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal" id="photoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Photo</h3>
                <button class="close-modal" id="closePhotoModal">‚úï</button>
            </div>
            <img id="modalPhoto" style="width: 100%; border-radius: 0.75rem;" alt="Full size photo">
        </div>
    </div>

    <script>
        // App State
        let currentRating = 0;
        let selectedMoods = [];
        let kidsPhotoData = null;
        let selfPhotoData = null;
        let currentView = 'daily';
        let currentMonthOffset = 0;
        let recognition = null;
        let currentVoiceInput = null;
        let db = null;

        // Daily prompts
        const prompts = [
            "What made you smile today?",
            "One thing you did well today?",
            "What are you grateful for?",
            "A small win you had today?",
            "What brought you peace today?",
            "What surprised you today?",
            "What did you learn today?",
            "How did you show yourself kindness?",
            "What moment would you relive?",
            "What made you proud today?"
        ];

        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('DiaryDB', 1);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains('entries')) {
                        database.createObjectStore('entries', { keyPath: 'date' });
                    }
                    if (!database.objectStoreNames.contains('settings')) {
                        database.createObjectStore('settings', { keyPath: 'key' });
                    }
                };
            });
        }

        async function saveEntryToDB(key, value) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['entries'], 'readwrite');
                const store = transaction.objectStore('entries');
                const request = store.put(value);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function getEntryFromDB(key) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['entries'], 'readonly');
                const store = transaction.objectStore('entries');
                const request = store.get(key);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllEntriesFromDB() {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['entries'], 'readonly');
                const store = transaction.objectStore('entries');
                const request = store.getAll();
                request.onsuccess = () => {
                    const entries = {};
                    request.result.forEach(entry => {
                        entries[entry.date] = entry;
                    });
                    resolve(entries);
                };
                request.onerror = () => reject(request.error);
            });
        }

        async function saveSettingToDB(key, value) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['settings'], 'readwrite');
                const store = transaction.objectStore('settings');
                const request = store.put({ key, value });
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function getSettingFromDB(key) {
            if (!db) await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['settings'], 'readonly');
                const store = transaction.objectStore('settings');
                const request = store.get(key);
                request.onsuccess = () => resolve(request.result ? request.result.value : null);
                request.onerror = () => reject(request.error);
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            await initDB();
            initializeApp();
            setupEventListeners();
            updateCurrentDate();
            await loadTodayEntry();
            await checkForPrompt();
        });

        function initializeApp() {
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('darkModeToggle').textContent = '‚òÄÔ∏è';
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('darkModeToggle').textContent = '‚òÄÔ∏è';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('darkModeToggle').textContent = 'üåô';
                }
            });

            // Initialize Web Speech API
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    if (currentVoiceInput) {
                        currentVoiceInput.value += (currentVoiceInput.value ? ' ' : '') + transcript;
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    if (currentVoiceInput && currentVoiceInput.dataset.voiceBtn) {
                        document.getElementById(currentVoiceInput.dataset.voiceBtn).classList.remove('recording');
                    }
                };

                recognition.onend = () => {
                    if (currentVoiceInput && currentVoiceInput.dataset.voiceBtn) {
                        document.getElementById(currentVoiceInput.dataset.voiceBtn).classList.remove('recording');
                    }
                };
            }
        }

        function setupEventListeners() {
            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                document.getElementById('darkModeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            });

            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const view = tab.dataset.view;
                    switchView(view);
                });
            });

            // Mood rating
            document.querySelectorAll('.mood-star').forEach(star => {
                star.addEventListener('click', () => {
                    const rating = parseInt(star.dataset.rating);
                    setMoodRating(rating);
                });
            });

            // Mood tags
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    toggleMoodTag(tag);
                });
            });

            // Photo uploads
            document.getElementById('kidsPhoto').addEventListener('change', (e) => {
                handlePhotoUpload(e, 'kids');
            });

            document.getElementById('selfPhoto').addEventListener('change', (e) => {
                handlePhotoUpload(e, 'self');
            });

            // Remove photos
            document.getElementById('removeKidsPhoto').addEventListener('click', () => {
                removePhoto('kids');
            });

            document.getElementById('removeSelfPhoto').addEventListener('click', () => {
                removePhoto('self');
            });

            // Voice input buttons
            document.getElementById('kidsVoiceBtn').addEventListener('click', () => {
                startVoiceInput('kidsText', 'kidsVoiceBtn');
            });

            document.getElementById('selfVoiceBtn').addEventListener('click', () => {
                startVoiceInput('selfText', 'selfVoiceBtn');
            });

            document.getElementById('promptVoiceBtn').addEventListener('click', () => {
                startVoiceInput('promptAnswer', 'promptVoiceBtn');
            });

            // Save entry
            document.getElementById('saveEntry').addEventListener('click', saveEntry);

            // Timeline filters
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    loadTimeline(btn.dataset.filter);
                });
            });

            // Month navigation
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentMonthOffset--;
                updateMonthlyView();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                if (currentMonthOffset < 0) {
                    currentMonthOffset++;
                    updateMonthlyView();
                }
            });

            // Photo modal
            document.getElementById('closePhotoModal').addEventListener('click', () => {
                document.getElementById('photoModal').classList.remove('active');
            });

            document.getElementById('photoModal').addEventListener('click', (e) => {
                if (e.target.id === 'photoModal') {
                    document.getElementById('photoModal').classList.remove('active');
                }
            });
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            document.getElementById('currentDay').textContent = now.toLocaleDateString('en-US', { weekday: 'long' });
        }

        function checkForPrompt() {
            const today = new Date().toDateString();
            const lastPromptDate = localStorage.getItem('lastPromptDate');
            const promptShownToday = lastPromptDate === today;

            // Show prompt randomly (30% chance) if not shown today
            if (!promptShownToday && Math.random() < 0.3) {
                const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
                document.getElementById('promptQuestion').textContent = randomPrompt;
                document.getElementById('dailyPrompt').style.display = 'block';
            }
        }

        function setMoodRating(rating) {
            currentRating = rating;
            document.querySelectorAll('.mood-star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function toggleMoodTag(tag) {
            const mood = tag.dataset.mood;
            if (tag.classList.contains('active')) {
                tag.classList.remove('active');
                selectedMoods = selectedMoods.filter(m => m !== mood);
            } else {
                tag.classList.add('active');
                selectedMoods.push(mood);
            }
        }

        function handlePhotoUpload(event, type) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const photoData = e.target.result;
                    if (type === 'kids') {
                        kidsPhotoData = photoData;
                        document.getElementById('kidsPhotoImg').src = photoData;
                        document.getElementById('kidsPhotoPreview').classList.add('has-photo');
                    } else {
                        selfPhotoData = photoData;
                        document.getElementById('selfPhotoImg').src = photoData;
                        document.getElementById('selfPhotoPreview').classList.add('has-photo');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function removePhoto(type) {
            if (type === 'kids') {
                kidsPhotoData = null;
                document.getElementById('kidsPhotoPreview').classList.remove('has-photo');
                document.getElementById('kidsPhoto').value = '';
            } else {
                selfPhotoData = null;
                document.getElementById('selfPhotoPreview').classList.remove('has-photo');
                document.getElementById('selfPhoto').value = '';
            }
        }

        function startVoiceInput(textareaId, btnId) {
            if (!recognition) {
                showMessage('Voice input is not supported in your browser', 'error');
                return;
            }

            const textarea = document.getElementById(textareaId);
            const btn = document.getElementById(btnId);

            currentVoiceInput = textarea;
            currentVoiceInput.dataset.voiceBtn = btnId;

            btn.classList.add('recording');
            recognition.start();
        }

        function saveEntry() {
            const kidsText = document.getElementById('kidsText').value.trim();
            const selfText = document.getElementById('selfText').value.trim();
            const promptAnswer = document.getElementById('promptAnswer').value.trim();

            if (!currentRating && !kidsText && !selfText && !promptAnswer) {
                showMessage('Please add at least some content to save your entry', 'error');
                return;
            }

            const today = new Date().toDateString();
            const entry = {
                date: today,
                timestamp: new Date().toISOString(),
                rating: currentRating,
                kidsText,
                kidsPhoto: kidsPhotoData,
                selfText,
                selfPhoto: selfPhotoData,
                moods: selectedMoods,
                promptAnswer,
                promptQuestion: document.getElementById('dailyPrompt').style.display !== 'none'
                    ? document.getElementById('promptQuestion').textContent
                    : null
            };

            // Save to localStorage
            const entries = getEntries();
            entries[today] = entry;
            localStorage.setItem('diaryEntries', JSON.stringify(entries));

            // Update last prompt date if prompt was shown
            if (entry.promptQuestion) {
                localStorage.setItem('lastPromptDate', today);
            }

            showMessage('‚ú® Entry saved successfully!', 'success');

            // Clear form after short delay
            setTimeout(() => {
                // Don't clear on same day, just show success
            }, 1000);
        }

        function loadTodayEntry() {
            const today = new Date().toDateString();
            const entries = getEntries();
            const entry = entries[today];

            if (entry) {
                // Load existing entry
                if (entry.rating) {
                    setMoodRating(entry.rating);
                }

                document.getElementById('kidsText').value = entry.kidsText || '';
                document.getElementById('selfText').value = entry.selfText || '';
                document.getElementById('promptAnswer').value = entry.promptAnswer || '';

                if (entry.kidsPhoto) {
                    kidsPhotoData = entry.kidsPhoto;
                    document.getElementById('kidsPhotoImg').src = entry.kidsPhoto;
                    document.getElementById('kidsPhotoPreview').classList.add('has-photo');
                }

                if (entry.selfPhoto) {
                    selfPhotoData = entry.selfPhoto;
                    document.getElementById('selfPhotoImg').src = entry.selfPhoto;
                    document.getElementById('selfPhotoPreview').classList.add('has-photo');
                }

                if (entry.moods) {
                    selectedMoods = entry.moods;
                    document.querySelectorAll('.mood-tag').forEach(tag => {
                        if (selectedMoods.includes(tag.dataset.mood)) {
                            tag.classList.add('active');
                        }
                    });
                }
            }
        }

        function showMessage(message, type) {
            const container = document.getElementById('successMessage');
            container.innerHTML = `<div class="success-message">${message}</div>`;

            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }

        function switchView(view) {
            currentView = view;

            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.view === view);
            });

            // Update view containers
            document.querySelectorAll('.view-container').forEach(container => {
                container.classList.remove('active');
            });

            document.getElementById(`${view}-view`).classList.add('active');

            // Load view-specific data
            if (view === 'timeline') {
                loadTimeline('all');
            } else if (view === 'weekly') {
                updateWeeklyView();
            } else if (view === 'monthly') {
                updateMonthlyView();
            }
        }

        function getEntries() {
            const data = localStorage.getItem('diaryEntries');
            return data ? JSON.parse(data) : {};
        }

        function loadTimeline(filter) {
            const entries = getEntries();
            const container = document.getElementById('timelineEntries');
            const flashbackContainer = document.getElementById('flashbackContainer');

            // Show flashback
            const flashback = getRandomFlashback();
            if (flashback) {
                flashbackContainer.innerHTML = `
                    <div class="flashback-card">
                        <div class="flashback-label">‚ú® Flashback</div>
                        <div class="flashback-date">${new Date(flashback.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                        <div class="flashback-text">${flashback.text}</div>
                    </div>
                `;
            } else {
                flashbackContainer.innerHTML = '';
            }

            // Filter entries
            let filteredEntries = Object.values(entries);
            const now = new Date();

            if (filter === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredEntries = filteredEntries.filter(e => new Date(e.date) >= weekAgo);
            } else if (filter === 'month') {
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredEntries = filteredEntries.filter(e => new Date(e.date) >= monthAgo);
            }

            // Sort by date (newest first)
            filteredEntries.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredEntries.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>No entries yet. Start writing your first moment!</p></div>';
                return;
            }

            container.innerHTML = filteredEntries.map(entry => {
                const date = new Date(entry.date);
                const specialMoment = entry.kidsText || entry.selfText || entry.promptAnswer || '';
                const photo = entry.kidsPhoto || entry.selfPhoto;
                const moodColor = entry.moods && entry.moods.length > 0
                    ? `var(--mood-${entry.moods[0]})`
                    : 'var(--color-primary)';

                return `
                    <div class="moment-card" style="border-left-color: ${moodColor}">
                        <div class="moment-date">${date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                        ${entry.rating ? `
                            <div class="moment-rating">
                                ${'‚≠ê'.repeat(entry.rating)}
                            </div>
                        ` : ''}
                        ${entry.kidsText ? `<div class="moment-text"><strong>Kids:</strong> ${entry.kidsText}</div>` : ''}
                        ${entry.selfText ? `<div class="moment-text"><strong>Self:</strong> ${entry.selfText}</div>` : ''}
                        ${entry.promptAnswer && entry.promptQuestion ? `
                            <div class="moment-text">
                                <strong>${entry.promptQuestion}</strong><br>
                                ${entry.promptAnswer}
                            </div>
                        ` : ''}
                        ${entry.moods && entry.moods.length > 0 ? `
                            <div class="moment-moods">
                                ${entry.moods.map(mood => `
                                    <span class="moment-mood-badge" style="background: var(--mood-${mood}); color: white;">
                                        ${mood}
                                    </span>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${photo ? `
                            <div class="moment-photo">
                                <img src="${photo}" alt="Moment photo" onclick="showPhotoModal('${photo}')">
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function getRandomFlashback() {
            const entries = Object.values(getEntries());
            const today = new Date().toDateString();
            const oldEntries = entries.filter(e => e.date !== today && new Date(e.date) < new Date());

            if (oldEntries.length === 0) return null;

            const random = oldEntries[Math.floor(Math.random() * oldEntries.length)];
            const text = random.kidsText || random.selfText || random.promptAnswer;

            return text ? { date: random.date, text } : null;
        }

        function updateWeeklyView() {
            const entries = Object.values(getEntries());
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const weekEntries = entries.filter(e => new Date(e.date) >= weekAgo);

            // Average mood
            const avgMood = weekEntries.length > 0
                ? (weekEntries.reduce((sum, e) => sum + (e.rating || 0), 0) / weekEntries.filter(e => e.rating).length).toFixed(1)
                : '-';
            document.getElementById('weeklyAvgMood').textContent = avgMood !== 'NaN' ? `${avgMood} ‚≠ê` : '-';
            document.getElementById('weeklyEntryCount').textContent = weekEntries.length;

            // Word cloud
            const words = extractWords(weekEntries);
            const wordCloudEl = document.getElementById('weeklyWordCloud');
            if (words.length > 0) {
                wordCloudEl.innerHTML = words.slice(0, 15).map(([word, count]) => {
                    const size = Math.min(0.8 + count * 0.1, 1.5);
                    return `<span class="word-cloud-item" style="font-size: ${size}rem">${word}</span>`;
                }).join('');
            } else {
                wordCloudEl.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center;">No words yet this week</p>';
            }

            // Photos
            const photos = weekEntries.flatMap(e => [e.kidsPhoto, e.selfPhoto]).filter(Boolean);
            const photosEl = document.getElementById('weeklyPhotos');
            if (photos.length > 0) {
                photosEl.innerHTML = photos.map(photo => `
                    <div class="photo-grid-item" onclick="showPhotoModal('${photo}')">
                        <img src="${photo}" alt="Week photo">
                    </div>
                `).join('');
            } else {
                photosEl.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: 2rem;">No photos this week</p>';
            }
        }

        function updateMonthlyView() {
            const now = new Date();
            const targetMonth = new Date(now.getFullYear(), now.getMonth() + currentMonthOffset, 1);
            const monthName = targetMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('currentMonth').textContent = monthName;

            const entries = Object.values(getEntries());
            const monthEntries = entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate.getMonth() === targetMonth.getMonth() &&
                       entryDate.getFullYear() === targetMonth.getFullYear();
            });

            // Statistics
            const avgMood = monthEntries.length > 0
                ? (monthEntries.reduce((sum, e) => sum + (e.rating || 0), 0) / monthEntries.filter(e => e.rating).length).toFixed(1)
                : '-';
            document.getElementById('monthlyAvgMood').textContent = avgMood !== 'NaN' ? `${avgMood} ‚≠ê` : '-';
            document.getElementById('monthlyEntryCount').textContent = monthEntries.length;

            // Best day
            const bestEntry = monthEntries.reduce((best, e) =>
                (e.rating || 0) > (best.rating || 0) ? e : best
            , {});
            document.getElementById('monthlyBestDay').textContent = bestEntry.rating
                ? new Date(bestEntry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                : '-';

            // Mood chart
            const chartEl = document.getElementById('monthlyMoodChart');
            const labelsEl = document.getElementById('monthlyMoodLabels');
            const daysInMonth = new Date(targetMonth.getFullYear(), targetMonth.getMonth() + 1, 0).getDate();
            const weeks = Math.ceil(daysInMonth / 7);

            const weeklyMoods = [];
            for (let i = 0; i < weeks; i++) {
                const weekStart = i * 7 + 1;
                const weekEnd = Math.min((i + 1) * 7, daysInMonth);
                const weekEntries = monthEntries.filter(e => {
                    const day = new Date(e.date).getDate();
                    return day >= weekStart && day <= weekEnd;
                });
                const weekAvg = weekEntries.length > 0
                    ? weekEntries.reduce((sum, e) => sum + (e.rating || 0), 0) / weekEntries.filter(e => e.rating).length
                    : 0;
                weeklyMoods.push(weekAvg);
            }

            const maxMood = Math.max(...weeklyMoods, 5);
            chartEl.innerHTML = weeklyMoods.map((mood, i) => {
                const height = (mood / maxMood) * 100;
                return `<div class="chart-bar" style="height: ${height}%" data-value="${mood.toFixed(1)}"></div>`;
            }).join('');

            labelsEl.innerHTML = weeklyMoods.map((_, i) => `
                <div class="chart-label">Week ${i + 1}</div>
            `).join('');

            // Photos
            const photos = monthEntries.flatMap(e => [e.kidsPhoto, e.selfPhoto]).filter(Boolean);
            const photosEl = document.getElementById('monthlyPhotos');
            if (photos.length > 0) {
                photosEl.innerHTML = photos.map(photo => `
                    <div class="photo-grid-item" onclick="showPhotoModal('${photo}')">
                        <img src="${photo}" alt="Month photo">
                    </div>
                `).join('');
            } else {
                photosEl.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: 2rem;">No photos this month</p>';
            }
        }

        function extractWords(entries) {
            const allText = entries.map(e => [e.kidsText, e.selfText, e.promptAnswer].filter(Boolean).join(' ')).join(' ');
            const words = allText.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 3 && !['that', 'this', 'with', 'have', 'from', 'were', 'been', 'they', 'what', 'when', 'where', 'while', 'their', 'there'].includes(word));

            const wordCount = {};
            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });

            return Object.entries(wordCount)
                .sort((a, b) => b[1] - a[1]);
        }

        function showPhotoModal(photoSrc) {
            document.getElementById('modalPhoto').src = photoSrc;
            document.getElementById('photoModal').classList.add('active');
        }
    </script>
</body>
</html>
